imports:
- path: projects.jinja

resources:
- name: project1
  type: projects.jinja
  properties:
    name: shared-vpc
    organizationId: [ORG_ID]
    billing-account-name: [billingAccounts/BILLING_ACCOUNT_ID]
    iam-policy-patch:
      add:
      - role: roles/viewer
        members:
        # CHANGEME: Change this to your email address
        - user:EMAIL
      - role: roles/compute.networkUser
        members:
        # CHANGEME: Change this to your email address
        - user:EMAIL
        - serviceAccount: service-$(ref.project2.projectNumber)@container-engine-robot.iam.gserviceaccount.com
        - serviceAccount: $(ref.project2.projectNumber)@cloudservices.gserviceaccount.com
      - role: roles/deploymentmanager.editor
        members:
        # CHANGEME: Change this to your email address
        - user:EMAIL
    shared_vpc_host: true
    
- name: project2
  type: projects.jinja
  properties:
    name: gke-test
    organizationId: $(ref.project1.organizationId)
    billing-account-name: $(ref.project1.billing-account-name)
    iam-policy-patch:
      add:
      - role: roles/editor
        members:
        # CHANGEME: Change this to your email address
        - user:EMAIL
      - role: roles/compute.admin
        members:
        # CHANGEME: Change this to your email address
        - user:EMAIL
    # CHANGEME: Change this to the name of your host project for the Shared VPC
    shared_vpc_service_of: $(ref.project1.projectId)
